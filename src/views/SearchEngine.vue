<template>
  <div class="retro-page">
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <div class="header-bar">
      <marquee behavior="scroll" direction="left">
        æ¬¢è¿ä½¿ç”¨å¤å¤æœç´¢å¼•æ“ - æ¢ç´¢äº’è”ç½‘çš„æ— é™å¯èƒ½ï¼ - Welcome to Retro Search Engine - Explore the Internet!
      </marquee>
    </div>

    <!-- ä¸»æ ‡é¢˜ -->
    <center>
      <h1 class="main-title">
        <font color="#0000FF">ğŸ”</font>
        <font color="#FF0000">å¤å¤æœç´¢å¼•æ“</font>
        <font color="#0000FF">ğŸ”</font>
      </h1>
      <p class="subtitle">Retro Search Engine - Since 1997</p>

      <br>
      <hr width="80%" size="3" color="#0000FF">
    </center>

    <!-- ä¸»æœç´¢åŒºåŸŸ -->
    <center>
      <table width="90%" border="3" cellpadding="15" cellspacing="0" bgcolor="#C0C0C0">
        <tr>
          <td bgcolor="#000080">
            <center>
              <font color="#FFFF00" size="+2"><b>â‰¡â‰¡â‰¡ ç½‘ç»œæœç´¢ä¸­å¿ƒ â‰¡â‰¡â‰¡</b></font>
            </center>
          </td>
        </tr>
        <tr>
          <td bgcolor="#E0E0E0">
            <center>
              <!-- æœç´¢æ¡† -->
              <table border="2" cellpadding="10" bgcolor="#FFFFFF" width="80%">
                <tr>
                  <td>
                    <form @submit.prevent="performSearch">
                      <table width="100%" border="0">
                        <tr>
                          <td colspan="2" align="center">
                            <font size="+1"><b>è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼š</b></font>
                          </td>
                        </tr>
                        <tr>
                          <td align="center" colspan="2">
                            <input
                              type="text"
                              v-model="searchQuery"
                              size="50"
                              style="font-size: 16px; padding: 5px;"
                              placeholder="è¾“å…¥æ‚¨è¦æœç´¢çš„å†…å®¹..."
                            >
                          </td>
                        </tr>
                        <tr>
                          <td colspan="2" align="center">
                            <font size="-1"><b>é€‰æ‹©æœç´¢å¼•æ“ï¼š</b></font>
                          </td>
                        </tr>
                        <tr>
                          <td colspan="2" align="center">
                            <select v-model="selectedEngine" style="font-size: 14px; padding: 5px; width: 200px;">
                              <option value="baidu">ç™¾åº¦ (Baidu)</option>
                              <option value="google">è°·æ­Œ (Google)</option>
                              <option value="bing">å¿…åº” (Bing)</option>
                              <option value="sogou">æœç‹— (Sogou)</option>
                              <option value="360">360æœç´¢</option>
                            </select>
                          </td>
                        </tr>
                        <tr>
                          <td colspan="2" align="center">
                            <br>
                            <button type="submit" style="font-size: 16px; padding: 10px 30px; cursor: pointer;">
                              <b>ğŸ” å¼€å§‹æœç´¢</b>
                            </button>
                          </td>
                        </tr>
                      </table>
                    </form>
                  </td>
                </tr>
              </table>

              <br><br>

              <!-- æœç´¢å¼•æ“å¿«æ·å…¥å£ -->
              <table width="80%" border="2" cellpadding="10" bgcolor="#FFFF99">
                <tr>
                  <td bgcolor="#008080">
                    <center>
                      <font color="#FFFFFF" size="+1"><b>ğŸŒ çƒ­é—¨æœç´¢å¼•æ“ç›´è¾¾</b></font>
                    </center>
                  </td>
                </tr>
                <tr>
                  <td>
                    <table width="100%" border="0" cellpadding="5">
                      <tr>
                        <td width="50%">
                          <b>â€¢ <a href="https://www.baidu.com" target="_blank">ç™¾åº¦æœç´¢</a></b> - ä¸­æ–‡æœç´¢é¢†å…ˆè€…
                        </td>
                        <td width="50%">
                          <b>â€¢ <a href="https://www.google.com" target="_blank">Googleæœç´¢</a></b> - å…¨çƒæœ€å¤§æœç´¢å¼•æ“
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <b>â€¢ <a href="https://www.bing.com" target="_blank">å¿…åº”æœç´¢</a></b> - å¾®è½¯æœç´¢å¼•æ“
                        </td>
                        <td>
                          <b>â€¢ <a href="https://www.sogou.com" target="_blank">æœç‹—æœç´¢</a></b> - æ™ºèƒ½æœç´¢å¼•æ“
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <b>â€¢ <a href="https://www.so.com" target="_blank">360æœç´¢</a></b> - å®‰å…¨æœç´¢å¼•æ“
                        </td>
                        <td>
                          <b>â€¢ <a href="https://duckduckgo.com" target="_blank">DuckDuckGo</a></b> - éšç§ä¿æŠ¤æœç´¢
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
            </center>
          </td>
        </tr>
      </table>

      <br><br>

      <!-- æœç´¢å†å² -->
      <table width="90%" border="3" cellpadding="10" cellspacing="0" bgcolor="#C0C0C0" v-if="searchHistory.length > 0">
        <tr>
          <td bgcolor="#800000">
            <center>
              <font color="#FFFF00" size="+1"><b>ğŸ“œ æœ€è¿‘æœç´¢å†å²</b></font>
            </center>
          </td>
        </tr>
        <tr>
          <td bgcolor="#FFE4B5">
            <table width="100%" border="1" cellpadding="5">
              <tr bgcolor="#D3D3D3">
                <th width="10%">åºå·</th>
                <th width="30%">æœç´¢å†…å®¹</th>
                <th width="20%">æœç´¢å¼•æ“</th>
                <th width="30%">æœç´¢æ—¶é—´</th>
                <th width="10%">æ“ä½œ</th>
              </tr>
              <tr v-for="(item, index) in searchHistory" :key="index" bgcolor="#FFFFFF">
                <td align="center">{{ index + 1 }}</td>
                <td>{{ item.query }}</td>
                <td align="center">{{ getEngineName(item.engine) }}</td>
                <td align="center">{{ formatDate(item.timestamp) }}</td>
                <td align="center">
                  <a href="#" @click.prevent="searchAgain(item)" style="text-decoration: none;">
                    <b>[é‡æ–°æœç´¢]</b>
                  </a>
                </td>
              </tr>
            </table>
            <br>
            <center>
              <button @click="clearHistory" style="padding: 5px 15px; cursor: pointer;">
                <b>ğŸ—‘ï¸ æ¸…ç©ºå†å²</b>
              </button>
            </center>
          </td>
        </tr>
      </table>

      <br>

      <!-- è¿”å›é“¾æ¥ -->
      <p>
        <a href="#" @click.prevent="$router.push('/')">
          <b>&lt;&lt; è¿”å›ä¸»é¡µ</b>
        </a>
      </p>

      <br>

      <!-- é¡µè„š -->
      <table border="1" cellpadding="5" bgcolor="#D3D3D3" width="80%">
        <tr>
          <td align="center">
            <font size="-1">
              <b>æç¤ºï¼š</b> é€‰æ‹©æ‚¨å–œæ¬¢çš„æœç´¢å¼•æ“ï¼Œè¾“å…¥å…³é”®è¯å³å¯å¼€å§‹æœç´¢ã€‚æœç´¢å°†åœ¨æ–°çª—å£æ‰“å¼€ã€‚
            </font>
          </td>
        </tr>
      </table>

      <br>
      <hr width="80%" size="3" color="#0000FF">

      <p>
        <font size="-1" color="#808080">
          Â© 1997 Retro Search Engine - Powered by Web 1.0 Technology
        </font>
      </p>
    </center>
  </div>
</template>

<script>
export default {
  name: 'SearchEngine',
  data() {
    return {
      searchQuery: '',
      selectedEngine: 'baidu',
      searchHistory: []
    }
  },
  mounted() {
    this.loadSearchHistory()
  },
  methods: {
    performSearch() {
      if (!this.searchQuery.trim()) {
        alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼')
        return
      }

      const searchEngines = {
        baidu: `https://www.baidu.com/s?wd=${encodeURIComponent(this.searchQuery)}`,
        google: `https://www.google.com/search?q=${encodeURIComponent(this.searchQuery)}`,
        bing: `https://www.bing.com/search?q=${encodeURIComponent(this.searchQuery)}`,
        sogou: `https://www.sogou.com/web?query=${encodeURIComponent(this.searchQuery)}`,
        360: `https://www.so.com/s?q=${encodeURIComponent(this.searchQuery)}`
      }

      const url = searchEngines[this.selectedEngine]

      // ä¿å­˜æœç´¢å†å²
      this.saveSearchHistory(this.searchQuery, this.selectedEngine)

      // åœ¨æ–°çª—å£æ‰“å¼€æœç´¢ç»“æœ
      window.open(url, '_blank')
    },

    async saveSearchHistory(query, engine) {
      const historyItem = {
        query,
        engine,
        timestamp: new Date().toISOString()
      }

      this.searchHistory.unshift(historyItem)

      // åªä¿ç•™æœ€è¿‘20æ¡
      if (this.searchHistory.length > 20) {
        this.searchHistory = this.searchHistory.slice(0, 20)
      }

      // ä¿å­˜åˆ°åç«¯
      try {
        await fetch('/api/search-history', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(this.searchHistory)
        })
      } catch (error) {
        console.error('ä¿å­˜æœç´¢å†å²å¤±è´¥:', error)
      }
    },

    async loadSearchHistory() {
      try {
        const response = await fetch('/api/search-history')
        if (response.ok) {
          const data = await response.json()
          this.searchHistory = data || []
        }
      } catch (error) {
        console.error('åŠ è½½æœç´¢å†å²å¤±è´¥:', error)
      }
    },

    async clearHistory() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æœç´¢å†å²å—ï¼Ÿ')) {
        this.searchHistory = []
        try {
          await fetch('/api/search-history', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify([])
          })
        } catch (error) {
          console.error('æ¸…ç©ºæœç´¢å†å²å¤±è´¥:', error)
        }
      }
    },

    searchAgain(item) {
      this.searchQuery = item.query
      this.selectedEngine = item.engine
      this.performSearch()
    },

    getEngineName(engine) {
      const names = {
        baidu: 'ç™¾åº¦',
        google: 'è°·æ­Œ',
        bing: 'å¿…åº”',
        sogou: 'æœç‹—',
        360: '360æœç´¢'
      }
      return names[engine] || engine
    },

    formatDate(timestamp) {
      const date = new Date(timestamp)
      return date.toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      })
    }
  }
}
</script>

<style scoped>
.retro-page {
  background-color: #C0C0C0;
  min-height: 100vh;
  padding: 20px;
  font-family: "MS Sans Serif", "Microsoft Sans Serif", sans-serif;
}

.header-bar {
  background-color: #000080;
  color: #FFFFFF;
  padding: 5px;
  margin-bottom: 20px;
  border: 2px solid #000000;
}

.main-title {
  margin: 20px 0 10px 0;
  text-shadow: 2px 2px #000000;
}

.subtitle {
  color: #008080;
  font-style: italic;
  margin: 5px 0;
}

a {
  color: #0000FF;
  text-decoration: underline;
}

a:visited {
  color: #800080;
}

a:hover {
  color: #FF0000;
}

table {
  margin: 10px auto;
}

input[type="text"] {
  border: 2px inset #808080;
}

button {
  border: 2px outset #808080;
  background-color: #C0C0C0;
  font-family: "MS Sans Serif", sans-serif;
}

button:active {
  border-style: inset;
}

select {
  border: 2px inset #808080;
  background-color: #FFFFFF;
  font-family: "MS Sans Serif", sans-serif;
}
</style>
