# 在线协作画布功能说明

## 概述

这是一个功能强大的实时协作画布系统，支持多用户同时在线绘画，所有绘画动作实时同步到所有在线用户。

## 核心功能

### 1. 多种绘画工具

- **铅笔工具** ✏️: 自由手绘，支持任意颜色和笔刷大小
- **橡皮擦** 🧹: 擦除画布内容
- **直线工具** 📏: 绘制直线，支持实时预览
- **矩形工具** ▭: 绘制矩形框，支持实时预览
- **圆形工具** ⭕: 绘制圆形，支持实时预览

### 2. 颜色和笔刷控制

- 自定义颜色选择器
- 10种快捷颜色预设（黑、白、红、绿、蓝、黄、品红、青、橙、紫）
- 笔刷大小调节（1-30px）
- 工具切换时自动禁用不相关选项

### 3. 历史记录管理

- **撤销功能** ↶: 撤销上一步操作（最多50步）
- **重做功能** ↷: 重做已撤销的操作
- 自动保存每次绘画操作到历史记录

### 4. 画布管理

- **清空画布** 🗑️: 清空所有内容并同步到所有用户
- **导出图片** 💾: 将当前画布导出为PNG图片
- 自适应画布大小，支持响应式布局

### 5. 轨迹回放

- **回放功能** ▶️: 回放整个绘画过程
- 实时显示回放进度条
- 支持停止回放并恢复到最新状态
- 回放速度: 200ms/帧

### 6. 实时协作

- 显示所有在线用户（带颜色标识）
- 实时同步所有用户的绘画动作
- 新用户加入时自动加载历史绘画
- WebSocket连接状态实时显示
- 用户自定义昵称

### 7. 触摸设备支持

- 完整的触摸事件支持
- 支持平板和手机绘画
- 触摸预览功能（形状工具）

## 技术架构

### 前端技术

- **Vue 3**: 使用Composition API构建响应式UI
- **Socket.IO Client**: WebSocket实时通信
- **HTML5 Canvas**: 高性能2D绘图
- **响应式设计**: 支持PC和移动设备

### 后端技术

- **Node.js + Express**: 后端服务器
- **Socket.IO**: WebSocket服务器
- **内存存储**: 画布数据和用户信息存储

### 实时通信协议

#### 客户端 → 服务器

- `user-join`: 用户加入画布
- `draw-start`: 开始绘画（包含位置、颜色、笔刷大小、工具类型）
- `draw-move`: 绘画移动（包含新位置）
- `draw-end`: 结束绘画
- `clear-canvas`: 清空画布

#### 服务器 → 客户端

- `canvas-init`: 初始化画布数据（历史路径、在线用户）
- `user-joined`: 新用户加入通知
- `user-left`: 用户离开通知
- `draw-start`: 其他用户开始绘画
- `draw-move`: 其他用户绘画移动
- `draw-end`: 其他用户结束绘画
- `canvas-cleared`: 画布被清空

## 使用说明

### 基本绘画

1. 选择一个绘画工具（铅笔、橡皮擦、直线、矩形、圆形）
2. 选择颜色和笔刷大小
3. 在画布上按住鼠标/触摸并移动开始绘画
4. 释放鼠标/触摸完成当前笔画

### 形状绘制

1. 选择形状工具（直线、矩形、圆形）
2. 在画布上按下鼠标确定起点
3. 移动鼠标查看实时预览
4. 释放鼠标确定终点并完成绘制

### 历史管理

- 点击"↶"按钮撤销上一步
- 点击"↷"按钮重做已撤销的操作
- 历史记录最多保存50步

### 回放轨迹

1. 点击"▶️"按钮开始回放
2. 观察绘画过程的重现
3. 点击"停止回放"按钮或回放完成后自动停止
4. 回放期间无法进行绘画操作

### 导出画布

- 点击"💾"按钮将当前画布导出为PNG图片
- 图片自动下载到本地，文件名包含时间戳

### 多人协作

- 输入您的用户名以便其他人识别
- 在线用户列表显示所有当前在线的用户
- 所有用户的绘画实时同步显示
- 每个用户有独特的颜色标识

## 性能优化

- 历史记录限制为50步，防止内存溢出
- 截图数量限制为100张
- WebSocket自动重连机制
- 画布尺寸自适应，避免过大画布影响性能

## 快捷操作

- **工具切换**: 点击工具栏上的图标
- **快速选色**: 使用颜色预设按钮
- **清空画布**: 点击清空按钮（会同步到所有用户，请谨慎使用）

## 浏览器兼容性

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+
- 移动端浏览器（iOS Safari, Chrome Mobile）

## 注意事项

1. 清空画布操作会影响所有在线用户
2. 历史记录是本地的，不会同步到其他用户
3. 回放功能仅回放本地的历史记录
4. 画布数据存储在服务器内存中，重启服务器会丢失
5. 形状工具的预览不会同步给其他用户，只有最终结果会同步

## 未来改进方向

- [ ] 添加文本工具
- [ ] 支持图层管理
- [ ] 画布数据持久化存储
- [ ] 支持导入图片
- [ ] 添加更多形状（三角形、星形等）
- [ ] 支持画笔透明度调节
- [ ] 添加渐变和填充功能
- [ ] 支持手势操作（缩放、平移）
